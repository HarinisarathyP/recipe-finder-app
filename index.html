<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Rescuer</title>
    <!-- Use Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #FF9A8B 0%, #FF6A88 50%, #FFB6C1 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .container-card {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 2rem;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1), 0 5px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease-in-out;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 100%;
            max-width: 900px;
        }

        h1, h2 {
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.1rem;
        }

        .loader {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #F266AB;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        .btn-pop {
            background: linear-gradient(45deg, #F266AB, #F87171);
            color: #ffffff;
            font-weight: 500;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 6px 10px -1px rgba(242, 102, 171, 0.2), 0 4px 6px -2px rgba(242, 102, 171, 0.08);
        }

        .btn-pop:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 15px -2px rgba(242, 102, 171, 0.3), 0 6px 8px -2px rgba(242, 102, 171, 0.1);
        }

        .recipe-card {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .recipe-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal specific styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            padding: 2rem;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1.5rem;
            max-width: 800px;
            margin: auto;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="px-4 container-card p-10">
        <h1 class="text-4xl font-bold text-gray-900 text-center mb-4">Recipe Rescuer üöÄ</h1>
        <p class="text-gray-600 text-center mb-8 font-medium">
            Let's turn what you have into something amazing! Find recipes based on your ingredients.
        </p>

        <!-- Ingredient-based search section -->
        <h2 class="text-2xl font-bold text-gray-800 mb-4">What's in the Fridge? üßä</h2>
        <div class="flex flex-col sm:flex-row gap-4 mb-8">
            <input
                type="text"
                id="ingredientInput"
                placeholder="e.g., chicken, pasta, beef"
                class="flex-grow p-4 rounded-full border border-gray-300 focus:ring-4 focus:ring-rose-400 focus:border-transparent outline-none transition-all duration-300 shadow-sm"
            />
            <button
                id="searchBtn"
                class="p-4 text-white font-semibold rounded-full shadow-md btn-pop focus:outline-none focus:ring-4 focus:ring-rose-500 focus:ring-opacity-50 transition-all duration-300"
            >
                Search by Ingredient
            </button>
        </div>

        <!-- Time-based search section -->
        <h2 class="text-2xl font-bold text-gray-800 mb-4">How much time do you have? ‚è∞</h2>
        <div class="grid grid-cols-2 gap-4 mb-8">
            <button class="time-btn p-4 text-white font-semibold rounded-full shadow-md btn-pop" data-time="30min">Under 30 Minutes</button>
            <button class="time-btn p-4 text-white font-semibold rounded-full shadow-md btn-pop" data-time="60min">Under 60 Minutes</button>
        </div>

        <!-- Meal-based search section -->
        <h2 class="text-2xl font-bold text-gray-800 mb-4">What's your mood? ‚ú®</h2>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8">
            <button class="meal-btn p-4 text-white font-semibold rounded-full shadow-md btn-pop" data-meal="Breakfast">Breakfast</button>
            <button class="meal-btn p-4 text-white font-semibold rounded-full shadow-md btn-pop" data-meal="Lunch">Lunch</button>
            <button class="meal-btn p-4 text-white font-semibold rounded-full shadow-md btn-pop" data-meal="Beef">Dinner</button>
            <button class="meal-btn p-4 text-white font-semibold rounded-full shadow-md btn-pop" data-meal="Dessert">Dessert</button>
        </div>

        <!-- Exclude ingredients section -->
        <h2 class="text-2xl font-bold text-gray-800 mb-4">What do you want to avoid? üö´</h2>
        <div class="flex flex-wrap gap-4 mb-8 text-gray-700">
            <label class="flex items-center space-x-2">
                <input type="checkbox" class="avoid-checkbox form-checkbox h-4 w-4 text-rose-500 rounded focus:ring-0" data-ingredient="Dairy">
                <span>Dairy</span>
            </label>
            <label class="flex items-center space-x-2">
                <input type="checkbox" class="avoid-checkbox form-checkbox h-4 w-4 text-rose-500 rounded focus:ring-0" data-ingredient="Gluten">
                <span>Gluten</span>
            </label>
            <label class="flex items-center space-x-2">
                <input type="checkbox" class="avoid-checkbox form-checkbox h-4 w-4 text-rose-500 rounded focus:ring-0" data-ingredient="Nuts">
                <span>Nuts</span>
            </label>
        </div>

        <div id="statusMessage" class="text-center text-gray-500 font-medium mb-8"></div>

        <div id="recipesContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
            <!-- Recipe cards will be dynamically inserted here -->
        </div>
    </div>

    <!-- The Modal for displaying recipe details -->
    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div id="modalContent">
                <!-- Recipe details will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ingredientInput = document.getElementById('ingredientInput');
            const searchBtn = document.getElementById('searchBtn');
            const mealButtons = document.querySelectorAll('.meal-btn');
            const timeButtons = document.querySelectorAll('.time-btn');
            const avoidCheckboxes = document.querySelectorAll('.avoid-checkbox');
            const recipesContainer = document.getElementById('recipesContainer');
            const statusMessage = document.getElementById('statusMessage');
            const recipeModal = document.getElementById('recipeModal');
            const closeModalBtn = document.querySelector('.close-btn');
            const modalContent = document.getElementById('modalContent');

            // Listen for clicks on the ingredient search button
            searchBtn.addEventListener('click', () => {
                const ingredient = ingredientInput.value.trim();
                if (ingredient) {
                    fetchRecipes(ingredient, 'i');
                } else {
                    displayMessage('Please enter an ingredient to search.');
                }
            });

            // Listen for clicks on the meal buttons
            mealButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const mealType = button.getAttribute('data-meal');
                    fetchRecipes(mealType, 'c');
                });
            });

            // Listen for clicks on the time buttons
            timeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const timeType = button.getAttribute('data-time');
                    let query;
                    // Creative mapping for time-based search using the existing API
                    if (timeType === '30min') {
                        query = 'Seafood'; // Seafood recipes are often quick to cook
                    } else if (timeType === '60min') {
                        query = 'Pasta'; // Pasta dishes are typically ready in under an hour
                    }
                    if (query) {
                        fetchRecipes(query, 'c');
                    }
                });
            });

            // Handle clicks on dynamically created recipe cards
            recipesContainer.addEventListener('click', (event) => {
                const card = event.target.closest('.recipe-card');
                if (card) {
                    const mealId = card.getAttribute('data-id');
                    fetchRecipeDetails(mealId);
                }
            });

            // Close the modal when the close button is clicked
            closeModalBtn.addEventListener('click', () => {
                recipeModal.style.display = 'none';
            });

            // Close the modal when the user clicks outside of it
            window.addEventListener('click', (event) => {
                if (event.target === recipeModal) {
                    recipeModal.style.display = 'none';
                }
            });

            async function fetchRecipes(query, type) {
                recipesContainer.innerHTML = '';
                displayMessage('<div class="flex justify-center items-center"><div class="loader"></div></div>');
                
                let url;
                if (type === 'i') {
                    // Search by ingredient
                    url = `https://www.themealdb.com/api/json/v1/1/filter.php?i=${query}`;
                } else if (type === 'c') {
                    // Search by category
                    url = `https://www.themealdb.com/api/json/v1/1/filter.php?c=${query}`;
                }

                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.meals) {
                        // Filter recipes based on "avoid" checkboxes
                        const filteredMeals = data.meals.filter(meal => {
                            const avoidIngredients = Array.from(avoidCheckboxes)
                                .filter(checkbox => checkbox.checked)
                                .map(checkbox => checkbox.getAttribute('data-ingredient').toLowerCase());
                            
                            // A simple check to see if the meal name contains a forbidden ingredient name
                            // Note: A more robust check would require a different API
                            return !avoidIngredients.some(avoidIng => meal.strMeal.toLowerCase().includes(avoidIng));
                        });

                        if (filteredMeals.length > 0) {
                            displayRecipes(filteredMeals);
                        } else {
                            displayMessage('No recipes found with those ingredients to avoid. Try a different combination!');
                        }
                    } else {
                        displayMessage('No recipes found for that selection. Try another one!');
                    }
                } catch (error) {
                    console.error('Failed to fetch recipes:', error);
                    displayMessage('An error occurred. Please try again later.');
                }
            }

            async function fetchRecipeDetails(mealId) {
                modalContent.innerHTML = '';
                // Use a loader within the modal while fetching
                modalContent.innerHTML = '<div class="flex justify-center items-center"><div class="loader"></div></div>';
                recipeModal.style.display = 'block';

                const url = `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${mealId}`;

                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    const meal = data.meals[0];

                    if (meal) {
                        renderRecipeDetails(meal);
                    } else {
                        modalContent.innerHTML = '<p class="text-center text-red-500">Failed to load recipe details.</p>';
                    }
                } catch (error) {
                    console.error('Failed to fetch recipe details:', error);
                    modalContent.innerHTML = '<p class="text-center text-red-500">An error occurred while fetching details.</p>';
                }
            }

            function displayRecipes(meals) {
                statusMessage.innerHTML = '';
                
                meals.forEach(meal => {
                    const recipeCard = document.createElement('div');
                    recipeCard.className = 'recipe-card bg-white rounded-2xl overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 cursor-pointer border border-gray-200';
                    recipeCard.setAttribute('data-id', meal.idMeal);
                    recipeCard.innerHTML = `
                        <img src="${meal.strMealThumb}" alt="${meal.strMeal}" class="w-full h-48 object-cover">
                        <div class="p-6">
                            <h3 class="text-lg font-semibold text-gray-800 truncate">${meal.strMeal}</h3>
                        </div>
                    `;
                    recipesContainer.appendChild(recipeCard);
                });
            }

            function renderRecipeDetails(meal) {
                // Construct the ingredients list dynamically
                let ingredientsList = '';
                for (let i = 1; i <= 20; i++) {
                    const ingredient = meal[`strIngredient${i}`];
                    const measure = meal[`strMeasure${i}`];
                    if (ingredient && ingredient.trim() !== "") {
                        ingredientsList += `<li><span class="font-semibold">${measure}</span> - ${ingredient}</li>`;
                    }
                }

                // Create the modal content HTML
                const modalHtml = `
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <img src="${meal.strMealThumb}" alt="${meal.strMeal}" class="w-full md:w-1/2 rounded-xl shadow-lg">
                        <div class="w-full md:w-1/2">
                            <h2 class="text-3xl font-bold mb-4 text-gray-800">${meal.strMeal}</h2>
                            <h3 class="text-xl font-semibold mb-2 text-gray-700">Ingredients</h3>
                            <ul class="list-disc list-inside space-y-1 text-gray-600 mb-6">
                                ${ingredientsList}
                            </ul>
                        </div>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">Instructions</h3>
                        <p class="text-gray-600 leading-relaxed whitespace-pre-wrap">${meal.strInstructions}</p>
                    </div>
                `;
                modalContent.innerHTML = modalHtml;
            }

            function displayMessage(message) {
                statusMessage.innerHTML = message;
            }
        });
    </script>
</body>
</html>
